<div class="container">

  <div class="pt-4">
    <div class="memory-date d-flex pb-1">
    <% @babies.each do |baby| %>
        <%= cl_image_tag baby.avatar.key, height: 50, class: "avatar-bordered", style: "border-color: #{baby.color}" %>
      <% end %>
      <h1 class=" px-2 pt-1"><%= @memory.title %></h1>
    </div>
    <div class="d-flex justify-content-between">
        <p class="babies-ages"><i><%= @memory.date.strftime('%d %b %Y') %></i></p>
        <% @babies.each do |baby| %>
        <p class="babies-ages"> <i>at <%= baby.age_with_month(@memory) %> old</i></p>
      <% end %>
      </div>
  </div>

  <div class="memory-medias d-flex w-100" data-controller="medias">
    <div class="row">
      <%# <% @memory.medias.reverse.each_with_index do |media, index| %>
        <% if @memory.medias[0].content_type.end_with?("mp4") %>

        <div class="col-8">
          <div class="image-container w-100" data-medias-target="video">
              <video width="254" height="260" src="<%= cl_video_path(@memory.medias[0].key) %>"  data-bs-toggle='modal' data-bs-target="#modal-<%= @memory.medias[0].key %>"></video>
          </div>
        </div>

        <div class="col-4">
          <div class="row">
            <% if @memory.medias[1] %>
              <%= cl_image_tag @memory.medias[1].key, width: 500, height: 500, crop: :fill, gravity: :faces, class: "picture object-fit-cover", data: { medias_target: "picture", bs_toggle: "modal", bs_target:"#modal-#{@memory.medias[1].key}" } %>
            <% end %>
          </div>

          <div class="row">
            <% if @memory.medias[2] %>
              <%= cl_image_tag @memory.medias[2].key, width: 500, height: 500, crop: :fill, gravity: :faces, class: "picture object-fit-cover", data: { medias_target: "picture", bs_toggle: "modal", bs_target:"#modal-#{@memory.medias[2].key}" } %>
            <% end %>
          </div>

        </div>
        <% else %>

        <div class="col-8">
          <div class="image-container w-100" >
            <%= cl_image_tag @memory.medias[0].key, width: 500, height: 500, crop: :fill, gravity: :faces, class: "picture object-fit-cover", data: { medias_target: "picture", bs_toggle: "modal", bs_target:"#modal-#{@memory.medias[0].key}" } %>
                <% if @memory.key_memories[0].event != "" %>
                  <%= render "shared/event" %>
                <% end %>
          </div>
        </div>

        <div class="col-4">
          <div class="row">
            <% if @memory.medias[1] %>
              <%= cl_image_tag @memory.medias[1].key, width: 500, height: 500, crop: :fill, gravity: :faces, class: "picture object-fit-cover", data: { medias_target: "picture", bs_toggle: "modal", bs_target:"#modal-#{@memory.medias[1].key}" } %>
            <% end %>
          </div>

          <div class="row">
            <% if @memory.medias[2] %>
              <%= cl_image_tag @memory.medias[2].key, width: 500, height: 500, crop: :fill, gravity: :faces, class: "picture object-fit-cover", data: { medias_target: "picture", bs_toggle: "modal", bs_target:"#modal-#{@memory.medias[2].key}" } %>
            <% end %>
          </div>

        </div>
        <% end %>

    </div>
      <!-- Modal -->
      <% @memory.medias.reverse.each_with_index do |media, index| %>
        <div class="modal fade" id="modal-<%= media.key %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-body">
                <% if media.content_type.end_with?("mp4") %>
                  <video width="372" height="364" class="baby-media" controls src="<%= cl_video_path(media.key) %>" data-medias-target="video"></video>
                <% else %>
                  <%= cl_image_tag media.key, width: 500, height: 500, crop: :fill, gravity: :faces, class: "baby-media object-fit-cover", data: { medias_target: "picture" } %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
     <% end %>
  </div>

  <div>
    <p class="babies-ages"><i class="fa-solid fa-location-dot px-1"></i><i><%= @memory.location %></i></p>
  </div>

  <div class="memory-content">
    <p><%= @memory.content %></p>
    <div class="author-signature text-end nickname-font p-3">
      <p><%= @memory.user.nickname.capitalize() %></p>
    </div>
  </div>

  <% if @linked_memories.length != 0 && @linked_memories[0].length != 0 %>
    <div class="d-flex justify-content-end">
      <div class="linked-events">
        <%# <h2>Related Memories</h2> %>
        <% @linked_memories.each do |memory_array| %>
          <% memory_array.each do |memory| %>
            <div class="linked-memory">
              <%= link_to "#{memory.key_memories[0].baby.nickname.capitalize()} - First time #{memory.key_memories[0].event}", memory_path(memory) %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @comments.length != 0 %>
    <div class="wrapper">
      <div class="divider div-transparent"></div>
    </div>

    <div class="memory-comments mb-3">
      <h2>Comments</h2>
      <% @comments.each do |comment| %>
        <div class="comment">
          <p><%= comment.content %></p>
          <p class="text-end nickname-font p-2"><%= comment.user.nickname.capitalize() %></p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
